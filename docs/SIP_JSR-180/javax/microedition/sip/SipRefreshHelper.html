<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN""http://www.w3.org/TR/REC-html40/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc on Wed Nov 26 13:59:56 EET 2003 -->
<TITLE>
SipRefreshHelper (JSR180 SIP API for J2ME)
</TITLE>
<META NAME="keywords" CONTENT="javax.microedition.sip.SipRefreshHelper,SipRefreshHelper class">
<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">
</HEAD>
<SCRIPT>
function asd()
{
parent.document.title="SipRefreshHelper (JSR180 SIP API for J2ME)";
}
</SCRIPT>
<BODY BGCOLOR="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../javax/microedition/sip/SipHeader.html"><B>PREV CLASS</B></A>&nbsp;
&nbsp;NEXT CLASS</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SipRefreshHelper.html" TARGET="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;
<SCRIPT>
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
<A HREF="../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>
</NOSCRIPT>
</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
javax.microedition.sip</FONT>
<BR>
Class SipRefreshHelper</H2>
<PRE>
java.lang.Object
  |
  +--<B>javax.microedition.sip.SipRefreshHelper</B>
</PRE>
<HR>
<DL>
<DT>public class <B>SipRefreshHelper</B><DT>extends java.lang.Object</DL>

<P>
This class implements the functionality that facilitates the handling of 
 refreshing requests on behalf of the application.
 Some SIP requests (REGISTER, SUBSCRIBE, ...) need to be timely 
 refreshed (binding between end point and server, see 
 RFC 3261 - chapter 10.2.1 page 58). For example the 
 REGISTER request (RFC 3261, chapter 10 page 56) 
 needs to be re-sent to ensure that the originating end point is still 
 well and alive. The request's validity is proposed by the end point in 
 the request and confirmed in the response by the registrar/notifier for 
 example in expires header (RFC 3261, chapter 2 page 5). The handling of 
 such binding would significantly increase application complexity and size. 
 As a consequence the <tt>SipRefreshHelper</tt> can be used to
 facilitate such operations. When the application wants to send a 
 refreshable request it:
 <p>
 <UL>
 <LI>implements <A HREF="./SipRefreshListener.html"><tt>SipRefreshListener</tt></A> callback interface.
 <LI>creates a new <A HREF="./SipClientConnection.html"><tt>SipClientConnection</tt></A> and sets it up.
 <LI>calls the method <A HREF="./SipClientConnection.html#enableRefresh(javax.microedition.sip.SipRefreshListener)"><tt>enableRefresh(SipRefreshListener)</tt></A>. A refresh ID is returned. If the request is not refreshable the method returns 0.
 <LI>if the refresh task fails a failure event is sent to the <A HREF="./SipRefreshListener.html"><tt>SipRefreshListener</tt></A>
 </UL>
 </p>
 A reference to the <tt>SipRefreshHelper</tt> object is obtained by 
 calling the static method <A HREF="./SipRefreshHelper.html#getInstance()"><tt>SipRefreshHelper.getInstance()</tt></A>
 (singleton pattern).
 <br><br>
 Finally, using the refresh ID returned from <A HREF="./SipClientConnection.html#enableRefresh(javax.microedition.sip.SipRefreshListener)"><tt>enableRefresh(SipRefreshListener)</tt></A> the application can:
 <p>
 <UL>
 <LI><A HREF="./SipRefreshHelper.html#stop(int)"><tt>stop()</tt></A> a refresh. The possible binding between end point and server 
 is cancelled (RFC3261, chapter 10.2.2 page 61).
 <LI><A HREF="./SipRefreshHelper.html#update(int, java.lang.String[], java.lang.String, int, int)"><tt>update(...)</tt></A> the refreshed request with new parameters (Contact info and new 
 payload). Note that this functionality is limited to the most typical case.
 A more complex case would require to stop the refresh and to create a 
 new request with the needed updates.
 </UL>
 </p>
 When all refresh tasks belonging to one refresh listener are stopped, the listener reference will be removed from the <tt>SipRefreshHelper</tt>.
 <p>
 Code example where REGISTER is sent, updated and finally stopped:
 <pre>
 class SipRefreshExample implements SipClientConnectionListener,
  SipRefreshListener { 

    int refreshID = 0; 
    int refreshStatus = 0; 
    SipRefreshHelper refHelper = null;

    public void sendRegister() { 
        SipClientConnection sc = null; 
        try { 
           sc = (SipClientConnection)
	         Connector.open("sip:sippy.user@host.com:5060");
           sc.setListener(this);
           sc.initRequest("REGISTER", null); 
           sc.setHeader("Contact", "&lt;sip:UserB@192.168.200.201&gt;;expires=3600"); 
           sc.setHeader("Contact", "&lt;mailto:UserB@biloxi.com&gt;;expires=4294967295"); 
           refreshID = sc.enableRefresh(this); 
           sc.send(); 
           refHelper = SipRefreshHelper.getInstance(); 
           //-----------------------------
           // do something else for a while
           //------------------------------
           // update REGISTER, with new "mailto:" Contact and no content
           if(refreshStatus == 200) { // check that refresh was successful
               String c[] = { "&lt;mailto:UserB@company.com&gt;" };
               refHelper.update(refreshID, c, null, 0, 6000);
           }
           //-----------------------------
           // do something else for a while
           //------------------------------
           // stop REGISTER refresh altogether
           if(refreshStatus == 200) { // check that refresh is still ok
               refHelper.stop(refreshID);
           }
        } catch(Exception ex) { // handle Exceptions 
        } 
    } 

    public void notifyResponse(SipClientConnection scc) { 
        try { 
           // retrieve the response received 
           scc.receive(0); 
           if(scc.getStatusCode() == 200) { 
              // handle 200 OK response
           }else { 
              // handle possible error responses
           }
        } catch(Exception ex) { 
            // handle Exceptions 
        } 
    } 

    public void refreshEvent(int ID, int statusCode, String reasonPhrase) { 
       refreshStatus = statusCode;
       if (statusCode == 0){ 
                // stopped refresh 
       }else if (statusCode == 200){ 
                // successful refresh
       }else { 
                // failed request 
       } 
    }
 } 
</pre>
<P>

<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../javax/microedition/sip/SipClientConnection.html#enableRefresh(javax.microedition.sip.SipRefreshListener)"><CODE>SipClientConnection.enableRefresh(SipRefreshListener)</CODE></A></DL>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->


<!-- =========== FIELD SUMMARY =========== -->


<!-- ======== CONSTRUCTOR SUMMARY ======== -->


<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;<A HREF="../../../javax/microedition/sip/SipRefreshHelper.html">SipRefreshHelper</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../javax/microedition/sip/SipRefreshHelper.html#getInstance()">getInstance</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Returns the instance of <tt>SipRefreshHelper</tt></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../javax/microedition/sip/SipRefreshHelper.html#stop(int)">stop</A></B>(int&nbsp;refreshID)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stop refreshing a specific request related to refeshID.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.io.OutputStream</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../javax/microedition/sip/SipRefreshHelper.html#update(int, java.lang.String[], java.lang.String, int, int)">update</A></B>(int&nbsp;refreshID,
       java.lang.String[]&nbsp;contact,
       java.lang.String&nbsp;type,
       int&nbsp;length,
       int&nbsp;expires)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Updates one refreshed request with new values.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TD><B>Methods inherited from class java.lang.Object</B></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->


<!-- ========= CONSTRUCTOR DETAIL ======== -->


<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Method Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="getInstance()"><!-- --></A><H3>
getInstance</H3>
<PRE>
public static <A HREF="../../../javax/microedition/sip/SipRefreshHelper.html">SipRefreshHelper</A> <B>getInstance</B>()</PRE>
<DL>
<DD>Returns the instance of <tt>SipRefreshHelper</tt>
<P>
<DD><DL>

<DT><B>Returns:</B><DD>the instance of <tt>SipRefreshHelper</tt> singleton</DL>
</DD>
</DL>
<HR>

<A NAME="stop(int)"><!-- --></A><H3>
stop</H3>
<PRE>
public void <B>stop</B>(int&nbsp;refreshID)</PRE>
<DL>
<DD>Stop refreshing a specific request related to refeshID. The 
 possible binding between end point and registrar/notifier is 
 cancelled (RFC3261, chapter 10.2.2  page 61). An event will be 
 sent to the listeners with refreshID and statusCode = 0 and 
 reasonPhrase = "refresh stopped".
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>refreshID</CODE> - the ID of the refresh to be stopped. If the ID does not match any refresh task the method does nothing.</DL>
</DD>
</DL>
<HR>

<A NAME="update(int, java.lang.String[], java.lang.String, int, int)"><!-- --></A><H3>
update</H3>
<PRE>
public java.io.OutputStream <B>update</B>(int&nbsp;refreshID,
                                   java.lang.String[]&nbsp;contact,
                                   java.lang.String&nbsp;type,
                                   int&nbsp;length,
                                   int&nbsp;expires)</PRE>
<DL>
<DD>Updates one refreshed request with new values.
 <br>
 <ul>
 <li>new <tt>Contact</tt> header values. existing values are kept if this is null.<br>
 <li><tt>Expires</tt> header value. expires = 0 has the same effect as 
 calling <tt>stop(refreshID)</tt>. expires = -1 leaves the <tt>Expires</tt> header out.<br>
 <li>new payload: <tt>Content-Type</tt> and <tt>Content-Length</tt>. The message is sent when 
 the returned <tt>OutputStream</tt> is closed. If no content is set the message will be 
 sent automatically and the method returns <tt>null</tt>.
 </ul>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>refreshID</CODE> - ID returned from <tt>enableRefresh(...)</tt>. If the ID does not match any refresh task the method just returns without doing anything.<DD><CODE>contact</CODE> - new Contact headers as String array. Replaces all old values. Multiple Contact header values are applicable only for REGISTER method. If contact param is null or empty the system will set the Contact header.<DD><CODE>type</CODE> - value of Content-Type (null or empty, no content)<DD><CODE>length</CODE> - value of Content-Length (<=0, no content)<DD><CODE>expires</CODE> - value of Expires (-1, no Expires header), (0, stop the refresh)
<DT><B>Returns:</B><DD>Returns the <tt>OutputStream</tt> to fill the content. If the update does not have new content (type = <tt>null</tt> and/or length = 0) method returns <tt>null</tt> and the message is sent automatically.
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - if some input parameter is invalid</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_bottom"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../javax/microedition/sip/SipHeader.html"><B>PREV CLASS</B></A>&nbsp;
&nbsp;NEXT CLASS</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html" TARGET="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SipRefreshHelper.html" TARGET="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;
<SCRIPT>
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
<A HREF="../../../allclasses-noframe.html" TARGET=""><B>All Classes</B></A>
</NOSCRIPT>
</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->

<HR>
<font size=-1>Copyright &copy; 2003 Nokia Corporation. All Rights Reserved.<br/>  Java is a trademark of Sun Microsystems, Inc.
</BODY>
</HTML>

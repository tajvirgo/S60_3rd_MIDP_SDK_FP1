<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.4.2_04) on Tue Jun 01 12:33:00 CEST 2004 -->
<TITLE>
MessageListener (WMA 2.0 Reference Implementation)
</TITLE>

<META NAME="keywords" CONTENT="javax.wireless.messaging.MessageListener interface">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="MessageListener (WMA 2.0 Reference Implementation)";
}
</SCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../javax/wireless/messaging/MessageConnection.html" title="interface in javax.wireless.messaging"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../javax/wireless/messaging/MultipartMessage.html" title="interface in javax.wireless.messaging"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="MessageListener.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A></NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
javax.wireless.messaging</FONT>
<BR>
Interface MessageListener</H2>
<HR>
<DL>
<DT>public interface <B>MessageListener</B></DL>

<P>
The <code>MessageListener</code> interface provides a mechanism for the
 application to be notified of incoming messages.
 
 <p>
 When an incoming message arrives, the <code>notifyIncomingMessage()</code>
 method is called. The application MUST retrieve the message using the <code>receive()</code>
 method of the <code>MessageConnection</code>.<tt>MessageListener</tt>
 should not call <tt>receive()</tt> directly. Instead, it can start a new
 thread which will receive the message or call another method of the
 application (which is outside of the listener) that will call <tt>receive()</tt>.
 For an example of how to use MessageListener, see <a href="#example">A
 Sample MessageListener Implementation</a>.
 </p>
 <p>
 The listener mechanism allows applications to receive incoming messages
 without needing to have a thread blocked in the <code>receive()</code>
 method call.
 </p>
 <p>
 If multiple messages arrive very closely together in time, the
 implementation has the option of calling this listener from multiple threads
 in parallel. Applications MUST be prepared to handle this and implement any
 necessary synchronization as part of the application code, while obeying the
 requirements set for the listener method.
 </p>
 <a name="example"></a>
 <h2>A Sample MessageListener Implementation</h2>
 <p>
 The following sample code illustrates how lightweight and resource-friendly
 a <tt>MessageListener</tt> can be. In the sample, a separate thread is
 spawned to handle message reading. The MIDlet life cycle is respected by
 releasing connections and signaling threads to terminate when the MIDlet is
 paused or destroyed.
 </p>
 
 <pre> // Sample message listener program.
 import java.io.IOException;
 import javax.microedition.midlet.*;
 import javax.microedition.io.*;
 import javax.wireless.messaging.*;
 public class Example extends MIDlet implements MessageListener 
 {
      MessageConnection messconn;
      boolean done;
      Reader reader;
      // Initial tests setup and execution.
      public void startApp() 
      {
 	        try 
          {
 	            // Get our receiving port connection.
 	            messconn = (MessageConnection)
 		        Connector.open("sms://:6222");
 	            // Register a listener for inbound messages.
 	            messconn.setMessageListener(this);
 	            // Start a message-reading thread.
 	            done = false;
 	            reader = new Reader();
 	            new Thread(reader).start();
 	        } catch (IOException e) 
          {
 	            // Handle startup errors
 	        }
      }
      // Asynchronous callback for inbound message.
 
      public void notifyIncomingMessage(MessageConnection conn) 
      {
 	        if (conn == messconn) 
          {
 	            reader.handleMessage();
 	        }
      }
 
      // Required MIDlet method - release the connection and
      // signal the reader thread to terminate.
      public void pauseApp() 
      {
 	        done = true;
 	        try 
          {
 	            messconn.close();
 	        } catch (IOException e) 
          {
 	            // Handle errors
 	        }
      }
      
      // Required MIDlet method - shutdown.
      // @param unconditional forced shutdown flag
      public void destroyApp(boolean unconditional) 
      {
 	        done = true;
 	        try 
          {
 	            messconn.setMessageListener(null);
 	            messconn.close();
 	        } catch (IOException e) 
          {
 	            // Handle shutdown errors.
 	        }
      }
}      
 // Isolate blocking I/O on a separate thread, so callback
 // can return immediately.
 class Reader implements Runnable 
 {
     private int pendingMessages = 0;
 	
     // The run method performs the actual message reading.
     public void run() 
     {
         while (!done) 
         {
             synchronized(this) 
             {
 		           if (pendingMessages == 0) 
                 {
 		               try 
                     {
 			               wait();
 			           } catch (Exception e) 
                     {
 			               // Handle interruption
 			           } 
 		           }
 		           pendingMessages--;
             }
 
             // The benefit of the MessageListener is here.
             // This thread could via similar triggers be
             // handling other kind of events as well in
             // addition to just receiving the messages.
 	
             try 
             {
                 Message mess = messconn.receive();
 		       } catch (IOException ioe) 
             {
 		           // Handle reading errors
 		       }
 	       }
 	   }
 
     public synchronized void handleMessage() 
     {
         pendingMessages++;
         notify();
     }
 	
 }
 </pre>
 
 <p>
 &nbsp;
 </p>
<P>

<P>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->


<!-- =========== FIELD SUMMARY =========== -->


<!-- ======== CONSTRUCTOR SUMMARY ======== -->


<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../javax/wireless/messaging/MessageListener.html#notifyIncomingMessage(javax.wireless.messaging.MessageConnection)">notifyIncomingMessage</A></B>(<A HREF="../../../javax/wireless/messaging/MessageConnection.html" title="interface in javax.wireless.messaging">MessageConnection</A>&nbsp;conn)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called by the platform when an incoming message arrives to a <code>MessageConnection</code>
 where the application has registered this listener object.
 
 </TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->


<!-- ========= CONSTRUCTOR DETAIL ======== -->


<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Method Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="notifyIncomingMessage(javax.wireless.messaging.MessageConnection)"><!-- --></A><H3>
notifyIncomingMessage</H3>
<PRE>public void <B>notifyIncomingMessage</B>(<A HREF="../../../javax/wireless/messaging/MessageConnection.html" title="interface in javax.wireless.messaging">MessageConnection</A>&nbsp;conn)</PRE>
<DL>
<DD>Called by the platform when an incoming message arrives to a <code>MessageConnection</code>
 where the application has registered this listener object.
 
 <p>
 This method is called once for each incoming message to the <code>MessageConnection</code>.
 </p>
 <p>
 <strong>NOTE</strong>: The implementation of this method MUST return
 quickly and MUST NOT perform any extensive operations. The application
 SHOULD NOT receive and handle the message during this method call.
 Instead, it should act only as a trigger to start the activity in the
 application's own thread.
 </p>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>conn</CODE> - the <code>MessageConnection</code> where the incoming
            message has arrived</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../javax/wireless/messaging/MessageConnection.html" title="interface in javax.wireless.messaging"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../javax/wireless/messaging/MultipartMessage.html" title="interface in javax.wireless.messaging"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="MessageListener.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A></NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
<p><address>Copyright (C) 2004 Siemens AG, Germany.       All rights reserved. Use is subject to license terms.</address>
</BODY>
</HTML>